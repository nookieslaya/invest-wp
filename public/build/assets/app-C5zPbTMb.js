const H=()=>{const t=document.querySelector(".site-header");if(!t)return;const o=()=>{t.setAttribute("data-scrolled",window.scrollY>10?"true":"false")};o(),window.addEventListener("scroll",o,{passive:!0});const r=t.querySelector("[data-menu-toggle]"),a=t.querySelector("[data-primary-nav]");if(r&&a){const n=window.matchMedia("(min-width: 768px)"),g=Array.from(a.querySelectorAll(".menu-item-has-children")),s=l=>{g.forEach(d=>{if(l&&(d===l||d.contains(l)))return;const p=d.querySelector("a"),e=d.querySelector("ul");d.classList.remove("is-submenu-open"),p&&p.setAttribute("aria-expanded","false"),e&&(e.classList.add("hidden"),e.classList.remove("flex"),e.setAttribute("aria-hidden","true"))})},i=(l,d)=>{const p=l.querySelector("a"),e=l.querySelector("ul");l.classList.toggle("is-submenu-open",d),p&&p.setAttribute("aria-expanded",d?"true":"false"),e&&(e.classList.toggle("hidden",!d),e.classList.toggle("flex",d),e.setAttribute("aria-hidden",d?"false":"true"))};g.forEach((l,d)=>{const p=l.querySelector("a"),e=l.querySelector("ul");!p||!e||(e.id||(e.id=`submenu-${d+1}`),p.setAttribute("aria-expanded","false"),p.setAttribute("aria-controls",e.id),e.setAttribute("aria-hidden","true"),p.addEventListener("click",c=>{if(n.matches)return;if(c.preventDefault(),l.classList.contains("is-submenu-open")){i(l,!1);return}s(l),i(l,!0)}))});const u=l=>{a.classList.toggle("hidden",!l),r.setAttribute("aria-expanded",l?"true":"false"),t.setAttribute("data-menu-open",l?"true":"false"),l||s()},y=l=>{if(l.matches){a.classList.remove("hidden"),r.setAttribute("aria-expanded","false"),t.setAttribute("data-menu-open","false"),s();return}u(!1)};y(n),n.addEventListener("change",y),r.addEventListener("click",()=>{const l=a.classList.contains("hidden");u(l)})}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",H):H();const D=()=>{document.querySelectorAll("[data-hero-slider]").forEach(o=>{const r=o.querySelector("[data-hero-track]"),a=o.querySelectorAll("[data-hero-slide]"),n=o.querySelector("[data-hero-prev]"),g=o.querySelector("[data-hero-next]"),s=o.querySelector("[data-hero-current]"),i=o.querySelector("[data-hero-total]");if(!r||a.length<2||!n||!g)return;let u=0;const y=d=>String(d).padStart(2,"0"),l=d=>{u=(d+a.length)%a.length,r.style.transform=`translateX(-${u*100}%)`,s&&(s.textContent=y(u+1))};i&&(i.textContent=y(a.length)),s&&(s.textContent=y(u+1)),n.addEventListener("click",()=>l(u-1)),g.addEventListener("click",()=>l(u+1)),window.addEventListener("resize",()=>{l(u)})})};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",D):D();const ut=document.querySelectorAll("[data-investment-floorplan]"),A="--",pt={available:"Wolne",reserved:"Rezerwacja",sold:"Sprzedane"},z=t=>t!=null&&t!=="",W=t=>z(t)?t:A,q=t=>typeof t!="number"||Number.isNaN(t)?A:`${Math.round(t).toLocaleString("pl-PL")} PLN`,mt=t=>typeof t!="number"||Number.isNaN(t)?A:`${Math.round(t).toLocaleString("pl-PL")} PLN/m2`,J=t=>{if(t==null||t==="")return null;const o=Number.parseInt(t,10);return Number.isNaN(o)?null:o},M=new URLSearchParams(window.location.search),N=J(M.get("building")??M.get("budynek")),U=J(M.get("floor")??M.get("pietro")),V=N!==null?`building-${N}`:null,gt=N!==null&&U!==null?`building-${N}-floor-${U}`:null,ft=t=>{if(t.dataset.floorInit==="true")return;const o=t.querySelector("svg");if(!o)return;t.dataset.floorInit="true";let r={};const a=t.dataset.apartments||"";if(a)try{r=JSON.parse(atob(a))}catch{r={}}const n=Array.from(o.querySelectorAll("[data-apartment-id]")),g=t.querySelector(".floorplan-wrapper")||t;let s=g.querySelector(".apartment-tooltip");s||(s=document.createElement("div"),s.className="apartment-tooltip",g.appendChild(s));const i=e=>{n.forEach(c=>c.classList.toggle("is-active",c.dataset.apartmentId===e))},u=(e,c)=>{if(!s||!g)return;const m=g.getBoundingClientRect();let f=null,h=null;if(e&&typeof e.clientX=="number"&&typeof e.clientY=="number")f=e.clientX-m.left+16,h=e.clientY-m.top+16;else if(c&&c.getBoundingClientRect){const w=c.getBoundingClientRect();f=w.left-m.left+w.width+12,h=w.top-m.top}f===null||h===null||(s.style.setProperty("--tooltip-x",`${f}px`),s.style.setProperty("--tooltip-y",`${h}px`))},y=(e,c)=>{const m=document.createElement("div");m.className="apartment-tooltip__row";const f=document.createElement("span");f.className="apartment-tooltip__label",f.textContent=e;const h=document.createElement("span");return h.className="apartment-tooltip__value",h.textContent=c,m.appendChild(f),m.appendChild(h),m},l=(e,c)=>{const m=document.createElement("div");m.className="apartment-tooltip__row";const f=document.createElement("span");f.className="apartment-tooltip__label",f.textContent=e;const h=document.createElement("span");return h.className="investment-status apartment-tooltip__status",h.dataset.status=c||"",h.textContent=pt[c]||c||A,m.appendChild(f),m.appendChild(h),m},d=e=>{if(!s)return;s.innerHTML="";const c=document.createElement("p");c.className="apartment-tooltip__title",c.textContent=e.label||"Mieszkanie";const m=W(e.area),f=m!==A&&!String(m).includes("m2")?`${m} m2`:m,h=W(e.rooms),w=document.createElement("p");w.className="apartment-tooltip__meta";const v=document.createElement("div");v.className="apartment-tooltip__grid",v.appendChild(y("Metraz",f)),v.appendChild(y("Pokoje",h)),v.appendChild(y("Cena",q(e.price_current??e.price))),v.appendChild(y("Cena za m2",mt(e.price_per_m2))),(e.promo||z(e.promo_label))&&v.appendChild(y("Promocja",e.promo_label||"Promocja")),(z(e.price_lowest_30)||e.promo)&&v.appendChild(y("Najnizsza 30 dni",q(e.price_lowest_30)));const _=Array.isArray(e.extras)?e.extras:[],T=_.length>0?q(e.extras_total):A;if(v.appendChild(y("Koszty dodatkowe",T)),v.appendChild(l("Status",e.status)),s.appendChild(c),s.appendChild(w),s.appendChild(v),_.length>0){const E=document.createElement("p");E.className="apartment-tooltip__section",E.textContent="Koszty dodatkowe",s.appendChild(E);const L=document.createElement("ul");L.className="apartment-tooltip__list",_.forEach(S=>{const x=document.createElement("li"),k=S.label?`${S.label}: `:"";x.textContent=`${k}${q(S.price)}`,L.appendChild(x)}),s.appendChild(L)}const $=Array.isArray(e.history)?e.history:[];if($.length>0){const E=document.createElement("p");E.className="apartment-tooltip__section",E.textContent="Historia cen",s.appendChild(E);const L=document.createElement("ul");L.className="apartment-tooltip__list",$.forEach(S=>{const x=document.createElement("li"),k=S.date?`${S.date}: `:"";x.textContent=`${k}${q(S.price)}`,L.appendChild(x)}),s.appendChild(L)}const C=document.createElement("p");C.className="apartment-tooltip__hint",C.textContent="Kliknij, aby zobaczyc",s.appendChild(C),s.classList.add("is-visible")},p=()=>{s&&s.classList.remove("is-visible")};n.forEach(e=>{const c=e.dataset.apartmentId;e.hasAttribute("tabindex")||e.setAttribute("tabindex","0");const m=r[c];m&&m.status?e.dataset.status=m.status:e.dataset.status="",e.addEventListener("mouseenter",f=>{const h=r[c];i(c),h&&(d(h),u(f))}),e.addEventListener("mousemove",u),e.addEventListener("mouseleave",()=>{p(),i(null)}),e.addEventListener("focus",f=>{const h=r[c];i(c),h&&(d(h),u(f,e))}),e.addEventListener("blur",()=>{p(),i(null)}),e.addEventListener("click",()=>{const f=r[c];f&&f.link&&(window.location.href=f.link)})}),n.length>0&&i(n[0].dataset.apartmentId)},ht=t=>{var u,y;const o=Array.from(t.querySelectorAll("[data-building-trigger]")),r=Array.from(t.querySelectorAll("[data-building-panel]")),a=(l,d)=>{const p=Array.from(l.querySelectorAll("[data-floor-view]")),e=Array.from(l.querySelectorAll("[data-floor-view-toggle]"));p.forEach(c=>{c.classList.toggle("hidden",c.dataset.floorView!==d)}),e.forEach(c=>{c.classList.toggle("is-active",c.dataset.floorViewToggle===d)}),d==="plan"&&ft(l),t.classList.toggle("is-table-view",d==="table")},n=(l,d=null)=>{o.forEach(p=>{p.classList.toggle("is-active",p.dataset.buildingTrigger===l)}),r.forEach(p=>{var c,m;const e=p.dataset.buildingPanel===l;if(p.classList.toggle("hidden",!e),e){const f=p.querySelectorAll("[data-floor-panel]"),h=p.querySelectorAll("[data-floor-trigger]"),w=d||((c=h[0])==null?void 0:c.dataset.floorTrigger)||((m=f[0])==null?void 0:m.dataset.floorPanel);w&&g(p,w)}})},g=(l,d)=>{const p=Array.from(l.querySelectorAll("[data-floor-trigger]")),e=Array.from(l.querySelectorAll("[data-floor-panel]"));p.forEach(c=>{c.classList.toggle("is-active",c.dataset.floorTrigger===d)}),e.forEach(c=>{const m=c.dataset.floorPanel===d;if(c.classList.toggle("hidden",!m),m){const f=c.dataset.floorViewDefault||"plan";a(c,f)}})};r.forEach(l=>{Array.from(l.querySelectorAll("[data-floor-trigger]")).forEach(e=>{e.addEventListener("click",()=>g(l,e.dataset.floorTrigger))}),Array.from(l.querySelectorAll("[data-floor-view-toggle]")).forEach(e=>{e.addEventListener("click",()=>{const c=e.closest("[data-floor-panel]");c&&a(c,e.dataset.floorViewToggle)})})}),o.forEach(l=>{l.addEventListener("click",()=>n(l.dataset.buildingTrigger))});const s=((u=o[0])==null?void 0:u.dataset.buildingTrigger)||((y=r[0])==null?void 0:y.dataset.buildingPanel),i=V||s;i&&n(i,i===V?gt:null)};ut.forEach(ht);const yt=document.querySelectorAll("[data-investment-floors-map]"),Y=t=>{if(!t)return;const o=document.querySelector("[data-investment-floorplan]");if(!o)return;const r=t.split("-floor-")[0],a=o.querySelector(`[data-building-trigger="${r}"]`);a&&a.click();const n=o.querySelector(`[data-floor-trigger="${t}"]`);n&&n.click(),o.scrollIntoView({behavior:"smooth",block:"start"})},X=(t,o,r)=>{if(!t)return"";const a=new URL(t,window.location.origin),n=o.match(/^building-(\d+)-floor-(\d+)$/);return n&&(a.searchParams.set("building",n[1]),a.searchParams.set("floor",n[2])),a.hash=r.startsWith("#")?r:`#${r}`,a.toString()},O=(t,o)=>{const r=t.dataset.floorTarget;if(r)return r;const a=t.dataset.floorIndex;if(a!==void 0&&a!=="")return`building-${o}-floor-${a}`;const n=t.dataset.floorId;if(!n)return"";if(n.startsWith("building-"))return n;const g=n.match(/^floor-(\d+)$/);if(g){const s=Number.parseInt(g[1],10);if(!Number.isNaN(s))return`building-${o}-floor-${Math.max(s-1,0)}`}return/^\d+$/.test(n)?`building-${o}-floor-${n}`:`building-${o}-${n}`},wt=t=>{const o=t.tagName?t.tagName.toLowerCase():"";o==="a"||o==="button"||t.hasAttribute("tabindex")||t.setAttribute("tabindex","0")};yt.forEach(t=>{const o=t.dataset.buildingIndex||"0",r=Number.parseInt(o,10)||0,a=t.dataset.investmentUrl||"",n=t.dataset.investmentAnchor||"pietra",g=Array.from(t.querySelectorAll("[data-floor-target], [data-floor-index], [data-floor-id]"));g.forEach(s=>{wt(s),s.addEventListener("click",()=>{const i=O(s,r);if(g.forEach(y=>y.classList.toggle("is-active",y===s)),document.querySelector("[data-investment-floorplan]")){Y(i);return}const u=X(a,i,n);u&&(window.location.href=u)}),s.addEventListener("keydown",i=>{if(i.key!=="Enter"&&i.key!==" ")return;i.preventDefault();const u=O(s,r);if(g.forEach(l=>l.classList.toggle("is-active",l===s)),document.querySelector("[data-investment-floorplan]")){Y(u);return}const y=X(a,u,n);y&&(window.location.href=y)})})});const K=()=>{const t=document.querySelectorAll("[data-gallery-card]");if(!t.length)return;if(!("IntersectionObserver"in window)){t.forEach(r=>r.classList.add("is-in-view"));return}const o=new IntersectionObserver(r=>{r.forEach(a=>{a.isIntersecting&&(a.target.classList.add("is-in-view"),o.unobserve(a.target))})},{threshold:.35,rootMargin:"0px 0px -10% 0px"});t.forEach(r=>o.observe(r))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",K):K();const P=(t,o=0,r=1)=>Math.min(Math.max(t,o),r),b=(t,o,r)=>t+(o-t)*r,bt=()=>{const t=window.innerWidth,o=window.innerHeight;if(t<768)return"mobile";const r=t<=1600,a=t<=1200;return o/t*100>=(a?70:r?65:62.5)?"tall":"wide"},G=()=>{const t=document.querySelectorAll("[data-investment-hero]");if(!t.length)return;const o=window.matchMedia("(prefers-reduced-motion: reduce)"),r=()=>{const i=bt();t.forEach(u=>{u.dataset.heroLayout=i})},a=i=>{const u=i.dataset.heroLayout||"wide",y=window.innerHeight||document.documentElement.clientHeight,l=(document.scrollingElement||document.documentElement).scrollTop,d=i.offsetTop,p=i.offsetHeight||1,e=Math.max(p-y,1),c=(l-d)/e,m=o.matches?1:P(c);if(u==="mobile"){i.style.setProperty("--hero-investment-y","0%"),i.style.setProperty("--hero-heading-left-x","0%"),i.style.setProperty("--hero-heading-right-x","0%"),i.style.setProperty("--hero-clip","polygon(100% 0, 100% 100%, 0 100%, 0 0)"),i.style.setProperty("--hero-image-top","0%"),i.style.setProperty("--hero-image-scale","1"),i.style.setProperty("--hero-image-wrapper-scale","1"),i.style.setProperty("--hero-caption-y","0%"),i.style.setProperty("--hero-caption-opacity","1"),i.style.setProperty("--hero-wrapper-y","0%");return}const f=.6,h=P(m/f),w=P((m-f)/(1-f)),T=P((m-.25)/.75),$=Math.pow(T,1.2),C=u==="tall"?-650:-550,E=u==="tall"?650:550,S=b(0,-100,w),x=b(0,C,$),k=b(0,E,$),B=b(12.91666667,0,h),R=b(64.16666667,100,h),j=b(87.08333333,100,h),F=b(35.83333333,0,h),tt=`polygon(${R}% ${B}%, ${R}% ${j}%, ${F}% ${j}%, ${F}% ${B}%)`,et=-6.45833335,ot=1,nt=1,rt=.9,at=b(et,0,h),st=b(ot,nt,w),it=b(rt,1,h),lt=u==="wide"?b(0,100,w):0,ct=u==="tall"?b(1,0,w):1,dt=b(0,12,w);i.style.setProperty("--hero-investment-y",`${S}%`),i.style.setProperty("--hero-heading-left-x",`${x}%`),i.style.setProperty("--hero-heading-right-x",`${k}%`),i.style.setProperty("--hero-clip",tt),i.style.setProperty("--hero-image-top",`${at}%`),i.style.setProperty("--hero-image-scale",st.toFixed(3)),i.style.setProperty("--hero-image-wrapper-scale",it.toFixed(3)),i.style.setProperty("--hero-caption-y",`${lt}%`),i.style.setProperty("--hero-caption-opacity",ct.toFixed(3)),i.style.setProperty("--hero-wrapper-y",`${dt}%`)},n=()=>{t.forEach(a)};r(),n();let g=null;const s=()=>{n(),g=window.requestAnimationFrame(s)};g=window.requestAnimationFrame(s),window.addEventListener("resize",()=>{r(),n()}),window.addEventListener("load",n),window.addEventListener("pagehide",()=>{g&&(window.cancelAnimationFrame(g),g=null)}),o.addEventListener?o.addEventListener("change",n):o.addListener&&o.addListener(n)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",G):G();const vt=document.querySelectorAll("[data-investments-module]"),Et={w_sprzedazy:"W sprzedaÅ¼y",zrealizowane:"Zrealizowane",w_przygotowaniu:"W przygotowaniu"},Q={w_sprzedazy:"#2f766a",zrealizowane:"#3d5a80",w_przygotowaniu:"#b07d3c"},St=t=>{const o=`
    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 40 40">
      <path d="M20 2c-6.6 0-12 5.4-12 12 0 9.4 12 24 12 24s12-14.6 12-24c0-6.6-5.4-12-12-12z" fill="${t}"/>
      <circle cx="20" cy="14" r="5" fill="white" fill-opacity="0.9"/>
    </svg>
  `;return`data:image/svg+xml;charset=UTF-8,${encodeURIComponent(o).replace(/%0A/g,"")}`},Lt=(()=>{let t;return o=>window.google&&window.google.maps?Promise.resolve(window.google.maps):o?t||(t=new Promise((r,a)=>{const n=document.createElement("script");n.src=`https://maps.googleapis.com/maps/api/js?key=${encodeURIComponent(o)}`,n.async=!0,n.defer=!0,n.onload=()=>r(window.google.maps),n.onerror=()=>a(new Error("Failed to load Google Maps")),document.head.appendChild(n)}),t):Promise.reject(new Error("Missing Google Maps API key"))})(),xt=t=>{const o=t.image?`<div class="relative">
        <img class="map-popup__image h-32 w-full object-cover" src="${t.image}" alt="">
        <button class="js-map-close absolute right-2 top-2 inline-flex h-7 w-7 items-center justify-center rounded-full bg-black/60 text-white" type="button" aria-label="Zamknij">
          <svg width="12" height="12" viewBox="0 0 12 12" fill="none" aria-hidden="true">
            <path d="M2 2l8 8M10 2L2 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </button>
      </div>`:"",r=t.link_url?`<a class="mt-3 !no-underline inline-flex items-center justify-center rounded-full bg-slate-900 px-4 py-2 text-xs font-semibold text-white no-underline" href="${t.link_url}" ${t.link_target?`target="${t.link_target}"`:""}>${t.link_title||"Zobacz"}</a>`:"",a=t.status_label||Et[t.status]||"",n=Q[t.status]||"#475569";return`
    <div class="map-popup w-60 font-sans text-slate-900">
      ${o}
      <div class="map-popup__body space-y-3">
        <div class="flex flex-wrap justify-between gap-2">
          <p class="text-sm font-semibold">${t.name||"Inwestycja"}</p>
          ${a?`<span class="text-xs font-semibold" style="color:${n}">${a}</span>`:""}
        </div>
        ${r}
      </div>
    </div>
  `},At=t=>{const o=t.querySelector("[data-investments-map]"),r=t.querySelectorAll("[data-investment-filter]"),a=o?o.querySelector("[data-map-message]"):null;if(!o)return;let n=[];try{const s=o.dataset.investments||"";s&&(n=JSON.parse(atob(s)))}catch{n=[]}if(!n.length){a&&(a.textContent="Brak inwestycji do wyswietlenia.");return}const g=o.dataset.apiKey||"";Lt(g).then(()=>{const s={lat:n[0].lat||52.2297,lng:n[0].lng||21.0122},i=new window.google.maps.Map(o,{center:s,zoom:10,mapTypeControl:!1,streetViewControl:!1}),u=new window.google.maps.InfoWindow,y=n.map(d=>{const p=Q[d.status]||"#dc2626",e=new window.google.maps.Marker({position:{lat:d.lat,lng:d.lng},map:i,icon:{url:St(p),scaledSize:new window.google.maps.Size(32,32),anchor:new window.google.maps.Point(16,32)}});return e.investmentStatus=d.status,e.addListener("click",()=>{u.setContent(xt(d)),u.open(i,e)}),e}),l=()=>{const d=new Set(Array.from(r).filter(p=>p.checked).map(p=>p.value));y.forEach(p=>{const e=d.has(p.investmentStatus);p.setMap(e?i:null)})};r.forEach(d=>{d.addEventListener("change",l)}),l(),window.google.maps.event.addListener(u,"domready",()=>{const d=document.querySelector(".js-map-close");d&&d.addEventListener("click",()=>u.close(),{once:!0})}),a&&a.remove()}).catch(s=>{a&&(a.textContent=s.message||"Mapa nie jest gotowa.")})};vt.forEach(At);const $t=document.querySelectorAll("[data-magnetic]"),Ct=(t,o,r)=>{const a=o.getBoundingClientRect(),n=t.clientX-a.left-a.width/2,g=t.clientY-a.top-a.height/2,s=-n/a.width*r,i=-g/a.height*r;o.style.transform=`translate3d(${s}px, ${i}px, 0)`},Z=t=>{t.style.transform="translate3d(0, 0, 0)"},kt=t=>{const o=Number(t.dataset.magneticStrength||10);t.addEventListener("mousemove",r=>Ct(r,t,o)),t.addEventListener("mouseleave",()=>Z(t)),t.addEventListener("blur",()=>Z(t))};$t.forEach(kt);const qt=document.querySelectorAll("[data-stacked-gallery]"),I=(t,o)=>{o.forEach((r,a)=>{const n=t[r];n&&(n.dataset.slot=String(a))})};qt.forEach(t=>{const o=Array.from(t.querySelectorAll("[data-stacked-item]"));if(o.length<2)return;const r=t.querySelector("[data-stacked-prev]"),a=t.querySelector("[data-stacked-next]"),n=o.map((i,u)=>u);I(o,n);const g=()=>{n.push(n.shift()),I(o,n)},s=()=>{n.unshift(n.pop()),I(o,n)};a&&a.addEventListener("click",g),r&&r.addEventListener("click",s)});
